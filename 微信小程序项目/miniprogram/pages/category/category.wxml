<view class="container">
  
  <view class="fixed-header">
    <view class="header-row">
      <view class="back-btn" wx:if="{{searchQuery}}" bindtap="resetSearch">
        <text class="back-icon">â†</text>
      </view>

      <view class="search-box">
        <view class="search-inner">
          <icon type="search" size="14" color="#999"></icon>
          <input 
            class="search-input"
            placeholder="è¯·è¾“å…¥æƒ³è¦æœç´¢çš„é¦™æ°´" 
            placeholder-class="ph-text"
            bindinput="onSearchInput" 
            value="{{searchQuery}}" 
            confirm-type="search"
          />
          <view class="clear-icon" wx:if="{{searchQuery}}" catchtap="resetSearch">Ã—</view>
        </view>
      </view>
    </view>

    <view class="sort-bar">
      <view class="sort-item {{activeTab===0 ? 'active' : ''}}" bindtap="onTabClick" data-index="0">ç»¼åˆ</view>
      <view class="sort-item {{activeTab===1 ? 'active' : ''}}" bindtap="onTabClick" data-index="1">é”€é‡</view>
      <view class="sort-item {{activeTab===2 ? 'active' : ''}}" bindtap="onTabClick" data-index="2">
        ä»·æ ¼ <text class="arrow">{{activeTab===2 ? (sortAsc ? 'â†‘' : 'â†“') : ''}}</text>
      </view>
      <view class="sort-item {{activeTab===3 ? 'active' : ''}}" bindtap="onTabClick" data-index="3">ä¸Šæ–°</view>
      <view class="sort-icon">âˆ·</view> 
    </view>
  </view>

  <view class="header-placeholder"></view>

  <scroll-view scroll-y class="scroll-area">
    <view class="goods-grid">
      <block wx:if="{{perfumes.length > 0}}">
        <view class="goods-card" wx:for="{{perfumes}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}">
          
          <view class="img-wrapper">
            <image src="{{item.image}}" mode="aspectFill" class="goods-img"></image>
            <view wx:if="{{item.isNew}}" class="badge-new">NEW</view>
            <view wx:if="{{item.stock < 5}}" class="badge-stock">ä»…å‰©{{item.stock}}ä»¶</view>
          </view>
          
          <view class="content">
            <view class="title">{{item.name}}</view>
            
            <view class="tags-row">
              <text class="tag-member" wx:if="{{item.isMember}}">ä¼šå‘˜ä»·</text>
              <text class="sold-num">å·²å”® {{item.sales}}</text>
            </view>
            
            <view class="bottom-row">
              <view class="price-wrapper">
                
                <block wx:if="{{item.hasDiscount}}">
                  <view class="price-lowest">
                    <text class="tag-coupon">åˆ¸å</text>
                    <text class="symbol">Â¥</text>
                    <text class="num">{{item.lowestPrice}}</text>
                  </view>
                  <view class="price-origin">{{item.isMember ? 'ä¼šå‘˜' : 'åŸä»·'}} Â¥{{item.currentPrice}}</view>
                </block>

                <block wx:else>
                  <view class="price-current">
                    <text class="symbol">Â¥</text>
                    <text class="num">{{item.currentPrice}}</text>
                  </view>
                  
                  <view class="price-origin" wx:if="{{item.isMember}}">åŸä»· Â¥{{item.originalPrice}}</view>
                  
                  <view class="price-origin" wx:else>åŠ å…¥ä¼šå‘˜äº«æŠ˜æ‰£</view>
                </block>

              </view>
              
              <view class="cart-btn" catchtap="addToCart" data-item="{{item}}">
                <text class="cart-icon">ğŸ›’</text> 
              </view>
            </view>

          </view>
        </view>
      </block>
      <view wx:else class="empty-tip">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³é¦™æ°´</view>
    </view>
  </scroll-view>
</view>