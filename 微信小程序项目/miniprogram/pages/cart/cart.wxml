<view class="container">
  
  <block wx:if="{{cartList.length > 0}}">
    <view class="header-bar">
      <view class="header-content">
        <text class="header-title luxury-serif">è´­ç‰©è¢‹</text>
        <view class="manage-btn" bindtap="toggleEditMode">
          {{isEditMode ? 'å®Œæˆ' : 'ç®¡ç†'}}
        </view>
      </view>
      <text class="header-subtitle">å·²é€‰ {{selectedCount}} / {{cartList.length}} ä»¶å•†å“</text>
    </view>

    <view class="cart-list">
      <block wx:for="{{cartList}}" wx:key="index">
        <movable-area class="item-area">
          <movable-view 
            class="item-view" 
            direction="horizontal" 
            out-of-bounds="true" 
            damping="40" 
            x="{{item.x}}" 
            data-index="{{index}}"
          >
            <view class="cart-item-content">
              <view class="checkbox-col" catchtap="toggleSelect" data-index="{{index}}">
                <view class="checkbox {{item.selected ? 'checked' : ''}}">
                  <text wx:if="{{item.selected}}" class="check-icon">âœ“</text>
                </view>
              </view>
              
              <view class="image-box">
                <image class="goods-img" src="{{item.image}}" mode="aspectFill"></image>
              </view>
              
              <view class="info-box">
                <view class="info-top">
                  <text class="brand">{{item.brand}}</text>
                  <text class="name">{{item.name}}</text>
                  <view class="spec-tag">{{item.spec || 'æ ‡å‡†è£…'}}</view>
                </view>

                <view class="info-bottom">
                  <text class="price">Â¥{{item.price}}</text>
                  <view class="stepper-minimal">
                    <view class="step-btn minus" catchtap="updateQuantity" data-index="{{index}}" data-type="minus"></view>
                    <text class="step-num">{{item.quantity}}</text>
                    <view class="step-btn plus" catchtap="updateQuantity" data-index="{{index}}" data-type="plus"></view>
                  </view>
                </view>
              </view>
            </view>

            <view class="slide-delete-btn" catchtap="deleteItem" data-index="{{index}}">
              <text>åˆ é™¤</text>
            </view>

          </movable-view>
        </movable-area>
      </block>
    </view>

    <view class="coupon-section" bindtap="goToCoupons" wx:if="{{!isEditMode}}">
      <view class="coupon-row">
        <view class="coupon-label">
          <text class="icon">ğŸŸ</text>
          <text>ç¤¼åˆ¸ä¸æƒç›Š</text>
        </view>
        <view class="coupon-value">
          <text wx:if="{{hasDiscount}}" class="discount-text">-Â¥{{discountAmount}}</text>
          <text wx:else class="placeholder">{{selectedCoupon ? selectedCoupon.name : 'é€‰æ‹©ä¼˜æƒ åˆ¸'}}</text>
          <text class="arrow">â€º</text>
        </view>
      </view>
    </view>

    <view class="footer-wrapper">
      <view class="footer-content">
        <view class="all-check-group" bindtap="toggleAll">
          <view class="checkbox small {{isAllSelected ? 'checked' : ''}}">
            <text wx:if="{{isAllSelected}}" class="check-icon">âœ“</text>
          </view>
          <text class="all-text">å…¨é€‰</text>
        </view>

        <view class="footer-right" wx:if="{{!isEditMode}}">
          
          <view class="price-info-col">
            <view class="main-price-row">
              <text class="total-label">åˆè®¡</text>
              <text class="total-price">Â¥{{finalPrice}}</text>
            </view>
            
            <view class="savings-row" wx:if="{{memberSavings > 0 || discountAmount > 0}}">
              <text class="origin-price">Â¥{{originalPrice}}</text>
              <text class="savings-tag">å·²çœ Â¥{{memberSavings}}</text>
            </view>
          </view>

          <view class="action-btn checkout" bindtap="onCheckout">ç»“ç®— ({{selectedCount}})</view>
        </view>

        <view class="footer-right" wx:else>
          <view class="action-btn delete" bindtap="batchDelete">åˆ é™¤æ‰€é€‰</view>
        </view>
      </view>
    </view>

  </block>

  <view wx:else class="empty-state">
    <view class="empty-icon">ğŸ‘œ</view>
    <view class="empty-text">æ‚¨çš„è´­ç‰©è¢‹æ˜¯ç©ºçš„</view>
    <navigator url="/pages/index/index" open-type="switchTab" class="go-shop-btn">å»é€›é€›</navigator>
  </view>

</view>